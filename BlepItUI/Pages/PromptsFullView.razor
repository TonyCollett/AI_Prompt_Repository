@page "/Prompts/"
@inject IPromptData promptData
@inject NavigationManager navManager
@inject AuthenticationStateProvider authProvider
@inject IUserData userData

@if (PromptList.Any())
{
<MudStack>
    <MudGrid>
    @foreach (var prompt in PromptPage)
    {
        <MudItem lg="4" md="6" xs="12">
            <PromptCard Prompt="prompt" />
        </MudItem>
    }
    </MudGrid>
    <MudPaper>
        <MudGrid Class="d-flex align-center mud-width-full py-3">
            <MudItem lg="1" xs="2"></MudItem>
                <MudItem lg="10" xs="8">
                <MudPagination 
                    Selected="CurrentPage" 
                    Count="TotalPages" 
                    SelectedChanged="OnPageChanged" 
                    ShowFirstButton="true" 
                    ShowLastButton="true" 
                    BoundaryCount="2" 
                    MiddleCount="3"  
                    Class="justify-center mud-width-full" />
            </MudItem>
            <MudItem lg="1" xs="2">
                <MudNumericField Margin="Margin.Dense" @bind-Value="CurrentPage" Min="1" Max="TotalPages" Variant="Variant.Outlined" Label="Page" />
            </MudItem>
        </MudGrid>
    </MudPaper>
</MudStack>
}

@code {
    private List<Prompt> PromptList = new List<Prompt>();
    private List<Prompt> PromptPage = new List<Prompt>();
    private int CurrentPage = 1;
    private int TotalPages = 0;

    protected override async Task OnInitializedAsync()
    {
        PromptList = await promptData.GetAllActivePromptsAsync();
        PromptPage = PromptList.Skip((CurrentPage - 1) * 12).Take(12).ToList();
        TotalPages = (int)Math.Ceiling((double)PromptList.Count / 12);
    }

    private void OnPageChanged(int newPage)
    {
        CurrentPage = newPage;
        PromptPage = PromptList.Skip((CurrentPage - 1) * 12).Take(12).ToList();
        TotalPages = (int)Math.Ceiling((double)PromptList.Count / 12);
    }
}